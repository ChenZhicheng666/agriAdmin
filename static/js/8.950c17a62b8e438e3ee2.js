webpackJsonp([8],{"Kng+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("lbHh");var s=a("mtWM"),r=a.n(s),n=a("uXZL"),l=a.n(n),i=a("VI/i"),o=a.n(i),d={data:function(){var e=function(e,t,a){t.length<11?a(new Error("请输入正确的手机号码")):a()};return{sels:[],rules:{username:[{required:!0,message:"输入不能为空"}],password:[{required:!0,message:"输入不能为空"}],type:[{required:!0,message:"输入不能为空"}],phonenum:[{required:!0,message:"输入不能为空"},{required:!0,trigger:"blur",validator:e},{required:!0,trigger:"change",validator:e}]},notType:!0,firstId0:[],companyList:[],positionList:[{positionId:0,label:"员工"},{positionId:1,label:"经理"},{positionId:2,label:"负责人"}],typeList:[{type:0,label:"管理部门"},{type:1,label:"消费者"},{type:2,label:"农户"},{type:3,label:"企业"},{type:4,label:"科研机构"},{type:5,label:"行业协会"},{type:6,label:"其他产业链"}],test:!1,selVisible:!1,dialogVisible:!1,form:{},tableData:[],tableHeader:["姓名","手机","企业","角色"]}},mounted:function(){var e=this;r.a.post("http://120.79.185.173:8080/agriculture/backend/enterprise/enterpriseGet.do",{status:1,pageSize:1e4,pageNum:1},{withCredentials:!0}).then(function(t){e.companyList=[];for(var a=0;a<t.data.data.list.length;a++){var s={enterpriseId:t.data.data.list[a].id,enterpriseName:t.data.data.list[a].name};e.companyList.push(s)}},function(e){console.log("error")});this.tableData;r.a.post("http://120.79.185.173:8080/agriculture/backend/user/usersGet.do",{pageNum:10}).then(function(t){e.tableData=[];for(var a=0;a<t.data.data.list.length;a++)if(t.data.data.list[a].relationships.length>0)for(var s=0;s<t.data.data.list[a].relationships.length;s++){var r={username:t.data.data.list[a].username,userId:t.data.data.list[a].userId,type:t.data.data.list[a].type,"姓名":t.data.data.list[a].username,"手机":t.data.data.list[a].phonenum,"企业":t.data.data.list[a].relationships[s].enterpriseName,"角色":t.data.data.list[a].relationships[s].position};e.tableData.push(r)}else{r={username:t.data.data.list[a].username,userId:t.data.data.list[a].userId,type:t.data.data.list[a].type,"姓名":t.data.data.list[a].username,"手机":t.data.data.list[a].phonenum,"企业":"个人种植户"};e.tableData.push(r)}}).catch(function(e){console.log("error")})},methods:{selsChange:function(e){this.sels=e},delAll:function(){var e=this,t=this.sels.length,a=this.sels;this.$confirm("此操作将永久删除该文件及其子文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){for(var s=0;s<t;s++)r.a.get("http://120.79.185.173:8080/agriculture/backend/user/userDel.do?userId="+a[s].userId).then(function(t){r.a.post("http://120.79.185.173:8080/agriculture/backend/user/usersGet.do",{pageNum:10}).then(function(t){e.tableData=[];for(var a=0;a<t.data.data.list.length;a++)if(t.data.data.list[a].relationships.length>0)for(var s=0;s<t.data.data.list[a].relationships.length;s++){var r={username:t.data.data.list[a].username,userId:t.data.data.list[a].userId,type:t.data.data.list[a].type,"姓名":t.data.data.list[a].username,"手机":t.data.data.list[a].phonenum,"企业":t.data.data.list[a].relationships[s].enterpriseName,"角色":t.data.data.list[a].relationships[s].position};e.tableData.push(r)}else{r={username:t.data.data.list[a].username,userId:t.data.data.list[a].userId,type:t.data.data.list[a].type,"姓名":t.data.data.list[a].username,"手机":t.data.data.list[a].phonenum,"企业":"个人种植户"};e.tableData.push(r)}}).catch(function(e){console.log("error")}),e.$message({type:"success",message:"删除成功!"})}).catch(function(t){e.$message({type:"warning",message:"删除失败!需要管理员权限"}),console.log("error")})}),this.dialogVisible=!1},setDisabled:function(){3===this.form.type?this.notType=!1:(this.notType=!0,this.form.company="",this.form.role="")},deleteFileOrDirectory:function(){this.sels.map(function(e){return e.id}).join();this.$confirm("此操作将永久删除该文件及其子文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){console.log("删除成功")})},renderAddRow:function(){var e=this,t=o.a.createHash("md5");t.update(this.form.password);var a=t.digest("hex"),s={username:this.form.username,phonenum:this.form.phonenum,password:a,type:this.form.type,enterprise:this.form.company,position:this.form.role};3===this.form.type&&r.a.post("http://120.79.185.173:8080/agriculture/backend/enterprise/enterpriseJoin.do",{enterpriseId:this.form.company,position:this.form.role}).then(function(t){e.$message({type:"success",message:"已申请加入企业"})}).catch(function(t){e.$message({type:"warning",message:"加入企业失败,需要管理员权限"}),console.log("error")}),r.a.post("http://120.79.185.173:8080/agriculture/portal/user/apply.do",s).then(function(t){r.a.post("http://120.79.185.173:8080/agriculture/backend/user/usersGet.do",{pageNum:10}).then(function(t){e.tableData=[];for(var a=0;a<t.data.data.list.length;a++)if(t.data.data.list[a].relationships.length>0)for(var s=0;s<t.data.data.list[a].relationships.length;s++){var r={username:t.data.data.list[a].username,userId:t.data.data.list[a].userId,type:t.data.data.list[a].type,"姓名":t.data.data.list[a].username,"手机":t.data.data.list[a].phonenum,"企业":t.data.data.list[a].relationships[s].enterpriseName,"角色":t.data.data.list[a].relationships[s].position};e.tableData.push(r)}else{r={username:t.data.data.list[a].username,userId:t.data.data.list[a].userId,type:t.data.data.list[a].type,"姓名":t.data.data.list[a].username,"手机":t.data.data.list[a].phonenum,"企业":"个人种植户"};e.tableData.push(r)}}).catch(function(e){console.log("error")}),e.$message({type:"success",message:"添加成功"})}).catch(function(t){e.$message({type:"warning",message:"添加失败"}),console.log("error")}),this.dialogVisible=!1},deleteAlert:function(e,t){var a=this;this.$confirm("此操作将永久删除该帐户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){r.a.defaults.withCredentials=!0,r.a.get("http://120.79.185.173:8080/agriculture/backend/user/userDel.do?userId="+t[e].userId).then(function(e){0===e.data.status?(r.a.post("http://120.79.185.173:8080/agriculture/backend/user/usersGet.do",{pageNum:10}).then(function(e){a.tableData=[];for(var t=0;t<e.data.data.list.length;t++)if(e.data.data.list[t].relationships.length>0)for(var s=0;s<e.data.data.list[t].relationships.length;s++){var r={username:e.data.data.list[t].username,userId:e.data.data.list[t].userId,type:e.data.data.list[t].type,"姓名":e.data.data.list[t].username,"手机":e.data.data.list[t].phonenum,"企业":e.data.data.list[t].relationships[s].enterpriseName,"角色":e.data.data.list[t].relationships[s].position};a.tableData.push(r)}else{r={username:e.data.data.list[t].username,userId:e.data.data.list[t].userId,type:e.data.data.list[t].type,"姓名":e.data.data.list[t].username,"手机":e.data.data.list[t].phonenum,"企业":"个人种植户"};a.tableData.push(r)}}).catch(function(e){console.log("error")}),a.dialogVisible=!1,a.$message({type:"success",message:"删除成功!"})):a.$message({type:"warning",message:"删除失败!需要管理员权限"})}).catch(function(e){a.$message({type:"warning",message:"删除失败!需要管理员权限"}),console.log("error")})}).catch(function(){a.$message({type:"info",message:"已取消删除"})})},deleteRow:function(e,t){t.splice(e,1)},handleFilePreview:function(e){this.handleFileChange(e)},handleFileChange:function(e,t){this.readerData(e.raw)},readerData:function(e){var t=this,a=new FileReader;a.onload=function(e){for(var a="",s=e.target.result,r=new Uint8Array(s),n=r.byteLength,i=0;i<n;i++)a+=String.fromCharCode(r[i]);var o=l.a.read(a,{type:"binary"}),d=o.SheetNames[0],u=o.Sheets[d],p=t.getHeaderRow(u),c=l.a.utils.sheet_to_json(u);t.generateDate({header:p,results:c})},a.readAsArrayBuffer(e)},generateDate:function(e){var t=e.header,a=e.results;this.tableHeader=t,this.tableData=a},fixdata:function(e){for(var t="",a=0,s=10240;a<e.byteLength/s;++a)t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(a*s,a*s+s)));return t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(a*s)))},getHeaderRow:function(e){var t=[],a=l.a.utils.decode_range(e["!ref"]),s=void 0,r=a.s.r;for(s=a.s.c;s<=a.e.c;++s){var n=e[l.a.utils.encode_cell({c:s,r:r})],i="UNKNOWN "+s;n&&n.t&&(i=l.a.utils.format_cell(n)),t.push(i)}return t}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-button",{attrs:{type:"success"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("添加")]),e._v(" "),a("el-upload",{staticClass:"inline",attrs:{action:"",multiple:!1,accept:".xlsx, .xls","on-change":e.handleFileChange,"on-preview":e.handleFilePreview,"auto-upload":!1}},[a("el-button",{attrs:{type:"success"}},[e._v("批量添加")])],1),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:e.delAll}},[e._v("批量删除")])],1),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.tableData,"header-cell-style":{background:"#1ca291",color:"#ffffff"},border:"","highlight-current-row":""},on:{"selection-change":e.selsChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),e._l(e.tableHeader,function(e){return a("el-table-column",{key:e.id,attrs:{prop:e,label:e}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),e.deleteAlert(t.$index,e.tableData)}}},[e._v("\n          移除\n        ")])]}}])})],2),e._v(" "),a("el-dialog",{attrs:{title:"添加用户",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form}},[a("el-form-item",{attrs:{label:"姓名",prop:"username"}},[a("el-input",{model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机",prop:"phonenum"}},[a("el-input",{attrs:{with:"300"},model:{value:e.form.phonenum,callback:function(t){e.$set(e.form,"phonenum",t)},expression:"form.phonenum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"类型",prop:"type"}},[a("el-select",{attrs:{filterable:"","allow-create":"",placeholder:"请选择标签"},on:{change:e.setDisabled},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.typeList,function(e){return a("el-option",{key:e.type,attrs:{label:e.label,value:e.type}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"企业"}},[a("el-select",{attrs:{disabled:e.notType,filterable:"","allow-create":"",placeholder:"请选择标签"},model:{value:e.form.company,callback:function(t){e.$set(e.form,"company",t)},expression:"form.company"}},e._l(e.companyList,function(e){return a("el-option",{key:e.enterpriseId,attrs:{label:e.enterpriseName,value:e.enterpriseId}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"角色"}},[a("el-select",{attrs:{disabled:e.notType,clearable:"",filterable:"","allow-create":"",placeholder:"请选择标签"},model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}},e._l(e.positionList,function(e){return a("el-option",{key:e.positionId,attrs:{label:e.label,value:e.positionId}})}),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.renderAddRow}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(d,u,!1,function(e){a("dBLa")},null,null);t.default=p.exports},dBLa:function(e,t){}});
//# sourceMappingURL=8.950c17a62b8e438e3ee2.js.map